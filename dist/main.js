/**
 * @license RequireJS domReady 2.0.1 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/domReady for details
 */

/* 
 * The MIT License
 *
 * Copyright 2017 Brian Akehurst.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */

define("domReady",[],function(){"use strict";function e(e){var t;for(t=0;t<e.length;t+=1)e[t](d)}function t(){var t=c;u&&t.length&&(c=[],e(t))}function n(){u||(u=!0,a&&clearInterval(a),t())}function i(e){return u?e(d):c.push(e),i}var r,o,a,s="undefined"!=typeof window&&window.document,u=!s,d=s?document:null,c=[];if(s){if(document.addEventListener)document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1);else if(window.attachEvent){window.attachEvent("onload",n),o=document.createElement("div");try{r=null===window.frameElement}catch(e){}o.doScroll&&r&&window.external&&(a=setInterval(function(){try{o.doScroll(),n()}catch(e){}},30))}"complete"===document.readyState&&n()}return i.version="2.0.1",i.load=function(e,t,n,r){r.isBuild?n(null):i(n)},i}),requirejs.config({baseUrl:"js",paths:{domReady:"libs/domReady"}}),require(["domReady!"],function(e){require(["app/app"],function(t){t.init(e)})}),define("main",function(){}),define("modules/utilities",[],function(){function e(e,t){return e.classList?e.classList.contains(t):!!e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}function t(e,t){t.forEach(function(t){n(e,t)})}function n(n,i){return Array.isArray(i)?t(n,i):void(n.classList?n.classList.add(i):e(n,i)||(n.className+=" "+i))}function i(e,t){t.forEach(function(t){r(e,t)})}function r(t,n){if(Array.isArray(n))return i(t,n);if(t.classList)t.classList.remove(n);else if(e(t,n)){var r=new RegExp("(\\s|^)"+n+"(\\s|$)");t.className=t.className.replace(r," ")}}function o(e){var t=e.getBoundingClientRect();return{x:t.left,left:t.left,y:t.top,top:t.top,width:t.width,height:t.height,right:t.right,bottom:t.bottom,centerX:t.left+t.width/2,centerY:t.top+t.height/2}}function a(e,t){return!(t.left>e.right||t.right<e.left||t.top>e.bottom||t.bottom<e.top)}function s(e,t){return a({left:e.x,right:e.x,top:e.y,bottom:e.y},t)}function u(e,t){return Math.floor(Math.random()*(t-e+1))+e}function d(e,t,n){var i;return function(){var r=this,o=arguments,a=function(){i=null,n||e.apply(r,o)},s=n&&!i;window.clearTimeout(i),i=window.setTimeout(a,t),s&&e.apply(r,o)}}function c(e,t){if(void 0!==e){var n=window.localStorage;if(void 0===t){var i=n.getItem(e);return i?JSON.parse(i):null}n.setItem(e,JSON.stringify(t))}}function l(e){try{screen.orientation.lock(e).then(function(){},function(){}).catch(function(){})}catch(e){}}function f(e){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?y():m(e)}function p(e){document.onfullscreenchange?document.onfullscreenchange=e:document.onwebkitfullscreenchange?document.onwebkitfullscreenchange=e:document.onmozfullscreenchange?document.onmozfullscreenchange=e:document.onmsfullscreenchange&&(document.onmsfullscreenchange=e)}var v=function(){var e={ogg:"audio/ogg",aac:"audio/aac",mp3:"audio/mpeg",mp4:"audio/mp4",wav:"audio/wav"};return function(t){Array.isArray(t)||(t=[t]);var n=document.createElement("audio");if(!n.canPlayType)return console.error("This browser doesn't support HTML5 audio unfortunately"),null;for(var i=0;i<t.length;i++){var r=document.createElement("source");r.setAttribute("src",t[i]),t[i].match(/\.(\w+)$/i)&&r.setAttribute("type",e[RegExp.$1]),n.appendChild(r)}try{return n.load(),n}catch(e){return console.error(e),null}}}(),h=function(e){this.id=null,this.interval=e};h.prototype={start:function(e,t){null===this.id&&(this.id=window.setInterval(function(){"function"==typeof e&&e.apply(t)},this.interval))},stop:function(){null!==this.id&&(window.clearInterval(this.id),this.id=null)}};var m=function(){var e=null;return document.documentElement.requestFullscreen?e=function(e){return e.requestFullscreen(),!0}:document.documentElement.mozRequestFullScreen?e=function(e){return e.mozRequestFullScreen(),!0}:document.documentElement.webkitRequestFullscreen?e=function(e){return e.webkitRequestFullscreen(),!0}:document.documentElement.msRequestFullscreen&&(e=function(e){return e.msRequestFullscreen(),!0}),function(t){return null!==e&&e(t||document.documentElement)}}(),y=function(){var e=null;return document.exitFullscreen?e=function(){return document.exitFullscreen(),!0}:document.mozCancelFullScreen?e=function(){return document.mozCancelFullScreen(),!0}:document.webkitExitFullscreen?e=function(){return document.webkitExitFullscreen(),!0}:document.msExitFullscreen&&(e=function(){return document.msExitFullscreen(),!0}),function(){return null!==e&&e.apply()}}();return function(){String.prototype.padLeft||(String.prototype.padLeft=function(e,t){return Array(e-this.length+1).join(t||" ")+this}),Math.radians||(Math.radians=function(e){return e*Math.PI/180}),Math.degrees||(Math.degrees=function(e){return 180*e/Math.PI}),Array.prototype.remove||(Array.prototype.remove=function(e){var t=this.indexOf(e);return e!==-1?this.splice(t,1):t}),function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}return"function"!=typeof window.CustomEvent&&(e.prototype=window.Event.prototype,void(window.CustomEvent=e))}(),"function"!=typeof Object.assign&&(Object.assign=function(e,t){"use strict";if(null===e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(null!==r)for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])}return n}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(e,t){function n(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)}if(null===this)throw new TypeError('"this" is null or not defined');var i=Object(this),r=i.length>>>0;if(0===r)return!1;for(var o=0|t,a=Math.max(o>=0?o:r-Math.abs(o),0);a<r;){if(n(i[a],e))return!0;a++}return!1}})}(),{hasClass:e,addClass:n,removeClass:r,getBounds:o,intersectRect:a,pointInRect:s,getRandomInt:u,Timer:h,debounce:d,localStorage:c,orientation:l,createsoundbite:v,enterFullScreen:m,exitFullScreen:y,toggleFullScreen:f,fullScreenChange:p}}),define("modules/particles",["modules/utilities"],function(e){function t(t){function n(n,i){t.appendChild(r);for(var a in n)o.hasOwnProperty(a)&&(o[a]=n[a]);for(var s=o.particles,u=0;u<o.particles;u++){var d=document.createElement("div");e.addClass(d,o.className),d.style.left=o.origin.x+"px",d.style.top=o.origin.y+"px",r.appendChild(d),d.offsetHeight;var c={x:e.getRandomInt(-o.radius,o.radius),y:e.getRandomInt(-o.radius,o.radius),z:e.getRandomInt(-o.radius,o.radius),s:e.getRandomInt(o.scaleMax/10,o.scaleMax)/10},l=e.getRandomInt(o.durationMax/10,o.durationMax);d.style.animation="yellowRed linear "+l/3+"ms",d.style.transitionDuration=l+"ms",d.style.transitionTimingFunction="linear",d.style.transform="translate3d("+c.x+"px,"+c.y+"px,"+c.z+"px) scale("+c.s+")",d.style.backgroundColor="red",d.style.opacity=.2,d.style.borderRadius="50%",d.addEventListener("transitionend",function(){this&&r&&r.contains(this)&&(r.removeChild(this),s--),s<1&&t&&r&&t.contains(r)&&(t.removeChild(r),r.innerHTML="","function"==typeof i&&i())},!1)}}function i(){r.innerHTML="";try{t.removeChild(r)}catch(e){}}var r=document.createElement("div"),o={className:"particle",origin:{x:0,y:0},particles:100,radius:100,scaleMax:30,durationMax:2500};return{explode:n,stop:i}}return{explosion:t}}),define("modules/sounds",["modules/utilities"],function(e){function t(e){if(!r()){var t=n[e];t&&t.play()}}var n={},i=function(){function t(t){return i||t.forEach(function(t){n.hasOwnProperty(t)||(n[t]=e.createsoundbite(r+t))}),!0}var i=!1,r="./sounds/";return function(e){return void 0!==e&&(i=t(e)),i}}(),r=function(){var e=!1;return function(t){return void 0!==t&&(e=t),e}}();return{load:i,mute:r,play:t}}),define("modules/arm",["modules/utilities","modules/particles","modules/sounds"],function(e,t,n){var i=function(i,r,o){function a(){i.removeEventListener("resizestart",h),i.removeEventListener("resizeend",m),i.removeEventListener("gameend",u),i.contains(k)&&(i.removeChild(k),k.innerHTML="")}function s(){u()}function u(){window.cancelAnimationFrame(g),g=null,S.stop(),a()}function d(e,t){if(null!==g){t.strength.reduce(r.strength),window.cancelAnimationFrame(g),g=null,L.style.opacity=0;var i=r.explosion;n.play(i.soundFile),i.origin={x:e.width/2,y:e.height/2},S.explode(i,function(){a()})}}function c(e){w||null===g&&(y(),k.style.transform="translate("+e.x+"px,"+e.y+"px) rotate("+v()+"deg)",i.appendChild(k),L.style.transitionDuration=M.explosion.durationMax+"ms",n.play(M.soundFile),p())}function l(){return e.getBounds(q)}function f(e){e=void 0!==e?e:60,E.y-=M.speed,M.behavior(E,C,e),L.style.top=E.y+"px",L.style.height=E.height+"px"}function p(t){if(F(t),!w){var n,r=l(),a=e.getBounds(i);if(f(F()),o)for(var s=0;s<o.length;s++){var c=o[s];if(n=c.bounds(),e.intersectRect(r,n))return d(r,c)}if(!e.intersectRect(r,a))return u()}g=window.requestAnimationFrame(p)}function v(e){return void 0!==e&&(M.rotate=e),M.rotate}function h(){w=!0}function m(e){w=!1,b=e.detail.height}function y(){b=window.innerHeight,i.addEventListener("resizestart",h),i.addEventListener("resizeend",m),i.addEventListener("gameend",u)}var g=null,w=!1,b=700,x=700,E={x:0,y:0,width:0,height:0},L=document.createElement("div"),k=document.createElement("div"),q=document.createElement("div"),S=t.explosion(q),M={className:"laser",explosion:{origin:{x:0,y:0},particles:50,radius:100,scaleMax:30,durationMax:2500,soundFile:""},width:4,length:!1,maxLength:!1,rotate:0,speed:3,soundFile:"",behavior:function(e,t,n){var i=b/x;t()?(e.height+=this.speed*n/60*i,e.height>this.maxLength*i&&t(!1)):e.height>this.length*i&&(e.height-=this.speed*n/60*i)}},F=function(){var e=0,t=60;return function(n){if(void 0!==n){var i=Math.round(1e3/(n-e));i>1&&(e=n,t=i)}return t}}(),C=function(){var e=!0;return function(t){return void 0!==t&&(e=t),e}}();return function(t){for(var n in t)M.hasOwnProperty(n)&&(M[n]=t[n]);e.addClass(L,"arm"),e.addClass(L,M.className),L.style.width=M.width+"px",L.style.height=M.width+"px",L.style.opacity=1,e.addClass(q,"hit"),e.addClass(k,"armbase"),L.appendChild(q),k.appendChild(L)}(r),{fire:c,rotate:v,bounds:l,dispose:s}};return{Arm:i}}),define("modules/armsFactory",["modules/utilities","modules/arm"],function(e,t){function n(e,t){if(void 0===e&&void 0===t)return m;var n=m[e];if(void 0!==t)for(var i in t)n[i]=t[i];return n}function i(){var e={};for(var t in m){var n=m[t];e[n.selectType]={className:n.className,selectType:n.selectType,div:null,qtyDiv:null,index:null,qty:0,max:0,time:n.refreshTime,timer:null}}return e}function r(e,t){m[e]=t}function o(e,n,i){return t.Arm(e,m[n],i)}function a(e){return void 0!==e?y[e]:y}function s(e){return g[e]}function u(){var e=[];for(var t in m){var n=m[t];e.includes(n.soundFile)||e.push(n.soundFile),e.includes(n.explosion.soundFile)||e.push(n.explosion.soundFile)}for(var i in y){var r=y[i];e.includes(r.explosion.soundFile)||e.push(r.explosion.soundFile)}return e}function d(e){return void 0!==e&&(y.spacePlayer.lang=e,v()),y.spacePlayer.lang}function c(e){return void 0!==e&&(y.spacePlayer.keyboard=e,v()),y.spacePlayer.keyboard}function l(e){return void 0!==e&&(y.spacePlayer.scores=e,v()),y.spacePlayer.scores}function f(e){var t=l();t.push(e),t.sort(function(e,t){return e.elapse<t.elapse?-1:e.elapse>t.elapse?1:0}),t.splice(10),l(t)}function p(e){y.spacePlayer.keyboard=e.keyboard,y.spacePlayer.lang=e.lang,y.spacePlayer.scores=e.scores}function v(){var t={};t.keyboard=y.spacePlayer.keyboard,t.lang=y.spacePlayer.lang,t.scores=y.spacePlayer.scores,e.localStorage(h,t)}var h="SPACEPIGS",m={missile:{className:"missile",selectType:"missileType",refreshTime:2e4,width:10,length:200,maxLength:300,explosion:{origin:{x:0,y:0},particles:100,radius:150,scaleMax:30,durationMax:2500,soundFile:"explosion1.mp3"},rotate:0,speed:5,strength:20,soundFile:"missile.mp3"},laser:{className:"laser",selectType:"laserType",refreshTime:15e3,explosion:{origin:{x:0,y:0},particles:50,radius:100,scaleMax:30,durationMax:2500,soundFile:"explosion1.mp3"},width:4,length:400,maxLength:400,rotate:0,speed:6,strength:12,soundFile:"laser.mp3"},gun:{className:"gun",selectType:"gunType",refreshTime:1e4,explosion:{origin:{x:0,y:0},particles:25,radius:50,scaleMax:30,durationMax:2500,soundFile:"explosion1.mp3"},width:0,length:200,maxLength:250,rotate:0,speed:3,strength:6,soundFile:"gun.mp3"},blueray:{className:"blueray",selectType:"bluerayType",refreshTime:1e4,explosion:{origin:{x:0,y:0},particles:25,radius:50,scaleMax:30,durationMax:2500,soundFile:"explosion1.mp3"},width:4,length:200,maxLength:250,rotate:0,radius:50,speed:4.5,strength:7,soundFile:"blueray.mp3"}},y={spacePlayer:{className:["surround","gunsurround"],html:'<div class="carriage playercarriage"><div  class="turret"><div class="barrel"></div></div><div class="percent"><div class="percentBar"></div></div></div>',callback:"",menuBounds:"",force:{max:48,increase:!0,time:1e4,value:1},explosion:{origin:{x:0,y:0},particles:100,radius:150,scaleMax:30,durationMax:2500,soundFile:"explosion2.mp3"},weapon:{nofire:!1,fireRate:500},keyboard:{moveLeft:"ArrowLeft",moveRight:"ArrowRight",rotateLeft:"a",rotateRight:"z",rotateCenter:"e",fire:"ArrowUp",changeArm:"Tab",dMove:15,dRotate:2},lang:"",scores:[]},spacePigs:{className:["surround","pigsurround"],html:'<div class="pig"></div><div class="carriage pigcarriage"><div class="turret pigturret"></div></div><div class="pighelmet"></div>',pig:0,numPigs:5,weapon:{type:"blueray",qty:1,noFire:!1},force:{max:24,increase:!0,time:1e4,value:1},explosion:{origin:{x:0,y:0},particles:100,radius:150,scaleMax:30,durationMax:2500,soundFile:"explosion2.mp3"}}},g={yOrbit:{radiusX:550,radiusY:0,radiusZ:7e3,speed:.5,center:{x:750,y:350,z:-5e3},firePos:{positions:[{angle:150,rotation:-1},{angle:270,rotation:-1}],range:{start:90,end:280}}},xOrbit:{radiusX:0,radiusY:300,radiusZ:3e3,speed:.7,center:{x:250,y:450,z:-4e3},firePos:{positions:[{angle:20,rotation:-1},{angle:50,rotation:-1},{angle:80,rotation:-1},{angle:110,rotation:-1}],range:{start:10,end:350}}},zOrbit:{radiusX:650,radiusY:120,radiusZ:0,speed:.25,center:{x:250,y:350,z:-8e3},firePos:{positions:[{angle:20,rotation:-1},{angle:160,rotation:-1}],range:{start:10,end:170}}}};return function(){var t=e.localStorage(h);t?p(t):v()}(),{arm:o,settings:n,selectTypes:i,addType:r,playerOptions:a,getOrbit:s,soundFiles:u,lang:d,keyboard:c,scores:l,addScore:f}}),define("modules/weapon",["modules/utilities","modules/armsFactory","modules/particles","modules/sounds"],function(e,t,n,i){var r=function(r,o){function a(){var t=e.getBounds(r),n=e.getBounds(o),i=n.x-t.x+n.width/2-5,a=n.y-t.y+n.height/2-12;return{x:i,y:a}}function s(e,t){o.addEventListener(e,t,!1)}function u(e,t){o.removeEventListener(e,t,!1)}function d(e){if(null!==b){var t=L();if(t){var n=b[t],i=n.pop();i&&(i.rotate(E()),L(t),i.fire(a()),"function"==typeof e&&e(i))}}}function c(e,n,i){var o;b.hasOwnProperty(e)?o=b[e]:(o=[],b[e]=o);for(var a=0;a<n;a++)void 0!==i&&o.push(t.arm(r,e,i))}function l(){for(var e in b){var t=b[e];t.forEach(function(e){e.dispose()})}b={}}function f(){e.addClass(o,"fadeout")}function p(e,t){var n=v();e.origin.x=n.width/2,e.origin.y=n.height/2,i.play(e.soundFile),g.explode(e,function(){"function"==typeof t&&t()})}function v(){return e.getBounds(o)}function h(){r.contains(o)||r.appendChild(o)}function m(){r.contains(o)&&r.removeChild(o)}function y(){l(),k.dispose(),m(),o.html=""}var g=n.explosion(o),w=o.querySelector(" .turret"),b={},x=function(){var e={x:0,y:0,z:0};return function(t,n,i){return void 0===t&&void 0===n&&void 0===i||(void 0!==t&&(e.x=t),void 0!==n&&(e.y=n),void 0!==i&&(e.z=i),o.style.transform="translate3d("+e.x+"px, "+e.y+"px, "+e.z+"px )"),e}}(),E=function(){var e=0;return function(t){return void 0!==t&&(e=t,w.style.transform="rotate("+e+"deg)"),e}}(),L=function(){var e=null;return function(t){return void 0===t?e:(b.hasOwnProperty(t)&&(e=t),e)}}(),k=function(){function t(t){function n(n){if(f!==n)return void 0!==f&&e.removeClass(d,l[f]),f=n,e.addClass(d,l[n]),t}return c&&(c.style.width=t+"%"),t>75?(void 0!==f&&(e.removeClass(d,l[f]),f=void 0),c&&(c.style.backgroundColor="green"),t):t>50?(c&&(c.style.backgroundColor="darkorange"),n(0)):t>25?(c&&(c.style.backgroundColor="darkred"),n(1)):n(t>0?2:3)}function n(e,n){p=e,y.detail.percent=t(Math.round(p/v*100)),y.detail.type=n,y.detail.force=e,y.detail.maxForce=v,o.dispatchEvent(y),p===v?m.stop():m.start(function(){s(h.value)})}function i(t){return t&&(h=t,p=t.max,v=t.max,m=new e.Timer(h.time)),h}function r(){return p}function a(e){if(e&&p){var t=p-e>=0?p-e:0;n(t,"reduce")}return p}function s(e){if(e){var t=p+e<=v?p+e:v;n(t,"add")}return p}function u(){m.stop()}var d=o.querySelector(" .carriage"),c=d.querySelector(" .percentBar"),l=["tint75","tint50","tint25","tint0"],f=void 0,p=0,v=0,h=null,m=null,y=new CustomEvent("strength",{detail:{type:"",force:0,maxForce:0,percent:0}});return{set:i,get:r,add:s,reduce:a,dispose:u}}();return{position:x,rotate:E,select:L,fire:d,loadArm:c,bounds:v,add:h,dispose:y,explode:p,fade:f,origin:a,strength:k,addEventListener:s,removeEventListener:u}};return{weapon:r}}),define("modules/player",["modules/utilities","modules/weapon"],function(e,t){var n=function(n,i){function r(t){var n=e.getBounds(E),i=L.bounds(),r=n.height-i.height,o=n.width-i.width-4;t=t>0?t:0,t=t<o?t:o,L.position(t,r,0)}function o(e){r(L.position().x+e)}function a(t,n){var i=L.origin(),r=e.getBounds(E),o=i.y+r.y-n+5,a=i.x+r.x-t+5,s=Math.degrees(Math.atan2(o,a))-90;L.rotate(s)}function s(t){var n={x:t.clientX,y:t.clientY},i=S();return e.pointInRect(n,i)?void(k=null):(i=L.bounds(),e.pointInRect(n,i)?void(k={target:"weapon",x:n.x,y:n.y}):(k={target:"container",x:n.x,y:n.y},void a(n.x,n.y)))}function u(){k&&"container"===k.target&&L.strength.get()>0&&!i.weapon.nofire&&M(),k=null}function d(e){k&&("container"===k.target?a(e.clientX,e.clientY):"weapon"===k.target&&(o(e.clientX-k.x),k.x=e.clientX,k.y=e.clientY))}function c(e){1===e.targetTouches.length&&s(e.targetTouches[0])}function l(){u()}function f(e){e.preventDefault(),e.targetTouches.length>0&&d(e.targetTouches[0])}function p(e){function t(t){e.preventDefault(),o(t)}function n(t){e.preventDefault();var n=L.rotate()+t;n>-90&&n<90&&L.rotate(n)}var r=i.keyboard;switch(e.key){case r.moveLeft:t(-r.dMove);break;case r.moveRight:t(r.dMove);break;case r.fire:e.preventDefault(),L.strength.get()>0&&L.fire(q);break;case r.rotateLeft:n(-r.dRotate);break;case r.rotateRight:n(r.dRotate);break;case r.rotateCenter:L.rotate(0);break;case r.changeArm:e.preventDefault()}}function v(){var t=e.getBounds(E),n=L.bounds();r(t.width/2-n.width/2)}function h(){E.addEventListener("mousedown",s,!1),E.addEventListener("mouseup",u,!1),E.addEventListener("mousemove",d,!1)}function m(){E.addEventListener("touchstart",c,!1),E.addEventListener("touchend",l,!1),E.addEventListener("touchmove",f,!1)}function y(){document.addEventListener("keydown",p,!1),document.addEventListener("keyup",u,!1)}function g(){E.addEventListener("resizeend",v)}function w(){E.removeEventListener("mousedown",s,!1),E.removeEventListener("mouseup",u,!1),E.removeEventListener("mousemove",d,!1),E.removeEventListener("touchstart",c,!1),E.removeEventListener("touchend",l,!1),E.removeEventListener("touchmove",f,!1),document.removeEventListener("keydown",p,!1),document.removeEventListener("keyup",u,!1),E.removeEventListener("resizeend",v)}function b(){w(),L.dispose()}var x=null,E=null,L=null,k=null,q=null,S=null,M=e.debounce(function(){L.fire(q)},i.weapon.fireRate,!0);return function(){q=i.callback,S=i.menuBounds,E=n,x=document.createElement("div"),x.innerHTML=i.html,e.addClass(x,i.className),L=t.weapon(E,x),L.add(),L.strength.set(i.force),v(),h(),m(),y(),g()}(),{dispose:b,fade:L.fade,bounds:L.bounds,origin:L.origin,explode:L.explode,select:L.select,load:L.loadArm,strength:L.strength,addEventListener:L.addEventListener,removeEventListener:L.removeEventListener}};return{player:n}}),define("modules/spacePlayer",["modules/utilities","modules/armsFactory","modules/player"],function(e,t,n){function i(e){if(0===e.detail.force){var t=this;this.fade(),this.explode(l.explosion,function(){u.detail.winner="pigs",u.detail.end=Date.now(),s.dispatchEvent(u),t.dispose()})}}function r(e){l.weapon.nofire=!0,d.removeEventListener("strength",i.bind(d)),s.removeEventListener("gameend",r),f.dispose()}function o(){return d}function a(e,t){return s=e,u=t,l.weapon.nofire=!1,d=n.player(s,l),d.addEventListener("strength",i.bind(d)),s.addEventListener("gameend",r),d}var s=void 0,u=void 0,d=void 0,c=t.selectTypes(),l=t.playerOptions("spacePlayer"),f=function(){function t(e){e.stopPropagation(),n(this)}function n(t){e.removeClass(g.div,w),e.addClass(t,w),i(t)}function i(e){var t=e.querySelector(" .armType div").className,n=c[t];g=n,d.select(n.className)}function r(t,n){t.qty+=n,t.qty=t.qty>0?t.qty:0,t.qty=t.qty<t.max?t.qty:t.max,t.qtyDiv.textContent=t.qty,0===t.qty?a()&&(e.addClass(t.qtyDiv,"qtyflash"),t.timer.start(function(){r(t,1),d.load(t.className,1,y)})):e.removeClass(t.qtyDiv,"qtyflash"),t.qty===t.max&&t.timer.stop()}function o(){r(g,-1)}function a(){var e=0;for(var t in c)e+=c[t].qty;return 0===e&&d.strength.reduce(l.force.max),e}function u(e){if(e.key===l.keyboard.changeArm){e.preventDefault();var t=c[g.selectType].index+1;t===m.length&&(t=0),n(m[t])}}function f(r){y=r,document.addEventListener("keyup",u,!1),h=s.querySelector(" .selector"),m=[].slice.call(h.querySelectorAll(" .selectArm")),m.forEach(function(n,i){n.addEventListener("click",t,!1);var r=n.querySelector(" .armType div").className,o=n.querySelector(" .armQty");e.removeClass(o,"qtyflash");var a=parseInt(o.getAttribute("data-max"));o.textContent=a,c[r].div=n,c[r].qtyDiv=o,c[r].index=i,c[r].qty=a,c[r].max=a,c[r].timer=new e.Timer(c[r].time),d.load(c[r].className,a,y)}),g?n(m[0]):i(m[0]);for(var o in c){var a=c[o];null===a.index&&delete c[o]}}function p(){return e.getBounds(h)}function v(){document.removeEventListener("keyup",u,!1),d.dispose(),m.forEach(function(e){e.removeEventListener("click",t,!1)});for(var e in c)c[e].timer.stop()}var h=void 0,m=void 0,y=void 0,g=void 0,w="armSelected";return{init:f,weaponFired:o,bounds:p,dispose:v}}();return l.callback=f.weaponFired,l.menuBounds=f.bounds,{init:a,selectorInit:f.init,getPlayer:o}}),define("modules/pig",["modules/utilities","modules/weapon"],function(e,t){var n=function(n,i){function r(){var t=v();if(t.length>1){var n=e.getRandomInt(0,t.length-1);return t[n]}return t[0]}function o(){var e=f.origin(),t=r().origin(),n=e.y-t.y+5,i=e.x-t.x+5,o=Math.degrees(Math.atan2(n,i))-90;f.rotate(o)}function a(e,t){f.loadArm(e,t,v())}function s(){}function u(){p(null),f.dispose()}var d=null,c=null,l=null,f=null,p=function(){var e;return function(t){return void 0!==t&&(e=t),e}}(),v=function(){var e=void 0;return function(t){return void 0!==t&&(e=t),e}}(),h=function(){var e;return function(t){return t>-1&&t<5&&(e=t,c.style.backgroundPositionX=25*e+"%"),e}}();return function(){l=n,d=document.createElement("div"),d.innerHTML=i.html,e.addClass(d,i.className),c=d.querySelector(" .pig"),h(i.pig),f=t.weapon(l,d),f.strength.set(i.force)}(),{players:v,pigNum:h,load:a,behavior:p,aim:o,resize:s,dispose:u,add:f.add,bounds:f.bounds,explode:f.explode,fade:f.fade,rotate:f.rotate,fire:f.fire,position:f.position,select:f.select,strength:f.strength,addEventListener:f.addEventListener,removeEventListener:f.removeEventListener}};return{pig:n}}),define("modules/behaviors",["modules/utilities","modules/armsFactory"],function(e,t){function n(e){return new p(e)}function i(e){return new v(e)}function r(e){return new h(e)}function o(){var e=document.querySelector("#space");e.removeEventListener("resizeend",a)}function a(e){u=e.detail.height,d=e.detail.width}function s(){var e=document.querySelector("#space");u=window.innerHeight,d=window.innerWidth,e.addEventListener("resizeend",a)}var u=700,d=1e3,c=700,l=1e3,f=function(e){var t=void 0,n="Base",i=-150;Object.defineProperty(this,"orbit",{get:function(){return t},set:function(e){void 0!==e&&(t=e)}}),Object.defineProperty(this,"pig",{get:function(){return e}}),Object.defineProperty(this,"angle",{get:function(){return i},set:function(e){void 0!==e&&(i=e)},configurable:!0}),Object.defineProperty(this,"speed",{get:function(){return t.speed},set:function(e){e&&(t.speed=e)}}),Object.defineProperty(this,"name",{get:function(){return n},set:function(e){e&&(n=e)}}),Object.defineProperty(this,"fH",{get:function(){return u/c}}),Object.defineProperty(this,"fW",{get:function(){return d/l}})};f.prototype={execute:function(e){},fire:function(t){if(!t.noFire){var n=Math.round(Math.abs(this.angle)/360),i=Math.round(Math.abs(this.angle)%360),r=this.orbit.firePos,o=this.pig;r.positions.forEach(function(a){a.rotation!==n&&i===a.angle&&(o.load(t.type,t.qty),o.aim(),o.fire(),a.angle=e.getRandomInt(r.range.start,r.range.end),a.rotation=n+1)})}}};var p=function(e){f.call(this,e),this.orbit=t.getOrbit("yOrbit"),this.name="YOrbit";var n=this.orbit.radiusX;Object.defineProperty(this,"radiusX",{get:function(){return n},set:function(e){e&&(n=e)}})};p.prototype=Object.create(f.prototype),p.prototype.execute=function(e,t){function n(){this.angle=this.angle-this.speed*e;var t=Math.round(this.orbit.center.x+this.radiusX*Math.cos(Math.radians(this.angle))),n=Math.round(this.orbit.center.y),i=Math.round(this.orbit.center.z+this.orbit.radiusZ*Math.sin(Math.radians(this.angle)));this.pig.position(t*this.fW,n*this.fH,i*this.fH)}n.call(this),t.noFire||this.fire.call(this,t)};var v=function(e){f.call(this,e),this.orbit=t.getOrbit("xOrbit"),this.name="XOrbit"};v.prototype=Object.create(f.prototype),v.prototype.execute=function(e,t){function n(){this.angle=this.angle+this.speed*e;var t=Math.round(this.orbit.center.z+this.orbit.radiusZ*Math.cos(Math.radians(this.angle))),n=Math.round(this.orbit.center.y+this.orbit.radiusY*Math.sin(Math.radians(this.angle))),i=Math.round(this.orbit.center.x);this.pig.position(i*this.fW,n*this.fH,t*this.fW)}n.call(this),t.noFire||this.fire.call(this,t)};var h=function(e){f.call(this,e),this.orbit=t.getOrbit("zOrbit"),this.name="ZOrbit"};return h.prototype=Object.create(f.prototype),h.prototype.execute=function(e,t){function n(){this.angle=this.angle+this.speed*e;var t=Math.round(this.orbit.center.x+this.orbit.radiusX*Math.cos(Math.radians(this.angle))),n=Math.round(this.orbit.center.y+this.orbit.radiusY*Math.sin(Math.radians(this.angle))),i=Math.round(this.orbit.center.z);this.pig.position(t*this.fW,n*this.fH,i*this.fH)}n.call(this),t.noFire||this.fire.call(this,t)},{init:s,rotateY:n,rotateX:i,rotateZ:r,dispose:o}}),define("modules/spacePigs",["modules/pig","modules/behaviors","modules/armsFactory"],function(e,t,n){function i(){w.textContent=x.toString(),b.detail.elapse=x.elapse(),b.detail.time=x.toString()}function r(e){e=void 0!==e?60/e:1,y.forEach(function(t){t.behavior().execute(e,m.weapon)})}function o(e){e.name!==this.behavior().name&&(e.angle=this.behavior().angle,this.behavior(e))}function a(e){if(0===e.detail.force){var n=this;y.remove(this),this.fade(),this.explode(m.explosion,function(){n.dispose(),0===y.length&&(b.detail.winner="player",g.dispatchEvent(b))})}else{var i=e.detail.percent;if(i>75)return o.call(this,t.rotateY(this)),void(this.behavior().speed=.5);if(i>50)return void(this.behavior().speed>=.25&&(this.behavior().speed=.25));if(i>=25)return o.call(this,t.rotateZ(this));if(i<25)return o.call(this,t.rotateX(this))}}function s(n){m.weapon.noFire=!1;for(var i=0;i<m.numPigs;i++){m.pig=i%5;var r=e.pig(g,m);r.players(n),r.load(m.weapon.type,m.weapon.qty),r.select(m.weapon.type);var o=t.rotateY(r),s=i%5*100<500?i%5*100:0;o.radiusX=o.radiusX+s,o.angle=o.angle+360*i/m.numPigs,r.behavior(o),r.addEventListener("strength",a.bind(r)),y[i]=r,r.add()}}function u(){return y}function d(){E.pause(!0)}function c(){E.pause(!1)}function l(e){x.stop(),m.weapon.noFire=!0,E.stop(),v()}function f(){g.addEventListener("resizestart",d),g.addEventListener("resizeend",c)}function p(){g.addEventListener("gameend",l)}function v(){t.dispose(),g.removeEventListener("resizestart",d),g.removeEventListener("resizeend",c),g.removeEventListener("gameend",l),y.forEach(function(e){e.dispose()}),y=[]}function h(e,n,i){g=e,w=g.querySelector(" .gameTime"),t.init(),b=i,s(n),f(),p(),x.reset(),E.start()}var m=n.playerOptions("spacePigs"),y=[],g=void 0,w=void 0,b=void 0,x=function(){function e(){return 0===o&&(o=Date.now()),o}function t(){return 0===a&&(a=Date.now()),a}function n(){return s=0===o?0:0!==a?a-o:Date.now()-o}function i(){var e=n(),t=Math.floor(e%36e5/6e4),i=Math.floor(e%36e4%6e4/1e3),r=Math.floor(e%36e4%6e4%1e3/10);return t.toString().padLeft(2,"0")+u+i.toString().padLeft(2,"0")+u+r.toString().padLeft(2,"0")}function r(){o=0,a=0,s=0}var o=0,a=0,s=0,u=":";return{start:e,stop:t,elapse:n,toString:i,reset:r}}(),E=function(){function e(t){a(t),s()||(i(),r(a())),o=window.requestAnimationFrame(e)}function t(){null===o&&(b.detail.start=x.start(),e())}function n(){null!==o&&(window.cancelAnimationFrame(o),o=null)}var o=null,a=function(){var e=0,t=60;return function(n){if(void 0!==n){var i=Math.round(1e3/(n-e));i>1&&(e=n,t=i)}return t}}(),s=function(){var e=!1;return function(t){return void 0!==t&&(e=t),e}}();return{start:t,stop:n,pause:s}}();return{init:h,dispose:v,getPigs:u}}),define("modules/spaceMenu",["modules/utilities","modules/armsFactory","modules/sounds"],function(e,t,n){function i(){S(L)}function r(){S(this)}function o(e){void 0===e?e=""===t.lang()?navigator.language.substring(0,2).toUpperCase():t.lang():m.includes(e)&&t.lang(e),m.includes(e)||(e="EN"),E.src="frames/"+e+"/menuFrame.html"}function a(){o(this.options[this.selectedIndex].value)}function s(i){function r(){n.mute(!this.checked)}function o(){e.toggleFullScreen(document.documentElement)}function s(){n.load(t.soundFiles()),q(!0),b.start.detail.chapter=1,b.end.detail.chapter=1,w.dispatchEvent(b.start)}L=i;var u=L.querySelector("#soundButton input");u.checked=!n.mute(),S(L),L.querySelector(" .startButton").addEventListener("click",s),L.querySelector(" .selectLang").addEventListener("change",a),u.addEventListener("change",r),L.querySelector(" .fullscreen").addEventListener("click",o)}function u(e){e.querySelector(" .closeButton").addEventListener("click",i),L.querySelector("#informationButton").addEventListener("click",r.bind(e))}function d(e,n){function o(t){"player"===t.detail.winner?(u=t.detail.time,d=t.detail.elapse,s.value="",S(e)):"pigs"===t.detail.winner?S(n):"abandon"===t.detail.winner&&S(L),q(!1)}function a(){if(""!==s.value){var e={name:s.value,time:u,elapse:d};t&&(t.addScore(e),l()),r.call(k)}else r.call(L)}var s=e.querySelector("input[name=player]"),u="",d=0;w.addEventListener("gameend",o),e.querySelector(" .closeButton").addEventListener("click",a),n.querySelector(" .closeButton").addEventListener("click",i)}function c(n,o){function a(){t.keyboard(l),i()}function s(){null!==f&&e.removeClass(f.button,"keySelect"),f=this,e.addClass(f.button,"keySelect")}function u(e){if(S()===o)if("Tab"===e.key){e.preventDefault();var t=f.index+1;t=t<c.length?t:0;var n=c[t],i=n.querySelector(" .keyValue");s.call({button:n,keyValue:i,index:t})}else f.keyValue.textContent=e.key,l[f.button.getAttribute("data-name")]=e.key}var d=o.querySelector("#keys"),c=[].slice.call(d.querySelectorAll(" .keyPanel")),l=t.keyboard(),f=null;L.querySelector("#keyboardButton").addEventListener("click",r.bind(o)),o.querySelector(" .closeButton").addEventListener("click",a),c.forEach(function(e,t){var n=e.querySelector(" .keyValue");n.textContent=l[e.getAttribute("data-name")],e.addEventListener("click",s.bind({button:e,keyValue:n,index:t})),0===t&&s.call({button:e,keyValue:n,index:t})}),n.addEventListener("keydown",u)}function l(){for(var e='<li><span class="scoreName">',n='</span><span class="scoreTime">',i="</span></li>",r=k.querySelector("ol"),o="";r.hasChildNodes();)r.removeChild(r.lastChild);t.scores().forEach(function(t){o+=e+t.name+n+t.time+i}),r.innerHTML=o}function f(e){k=e,k.querySelector(" .closeButton").addEventListener("click",i),
L.querySelector("#scoresButton").addEventListener("click",r.bind(k)),l()}function p(e){"portrait"===e.detail.mode?(q(!1),r.call(y.querySelector("#portrait"))):(q(!0),r.call(L))}function v(){y=this.contentDocument,s(y.querySelector("#principal")),d(y.querySelector("#winner"),y.querySelector("#loser")),u(y.querySelector("#information")),c(y,y.querySelector("#keyboard")),f(y.querySelector("#scores"))}function h(e,t){g=document.querySelector("#container"),window.addEventListener("resize",M),w=e,w.addEventListener("orientation",p),b=t,x=g.querySelector("#menuDiv"),E=g.querySelector("#menu"),E.addEventListener("load",v),o()}var m=["EN","FR"],y=void 0,g=void 0,w=void 0,b=void 0,x=void 0,E=void 0,L=void 0,k=void 0,q=function(){var e=!1;return function(t){return void 0!==t&&(e=t,e===!0?(x.style.display="none",w.style.display="block",document.documentElement.focus()):(x.style.display="flex",w.style.display="none")),e}}(),S=function(){var t=void 0;return function(n){return void 0!==n&&(void 0!==t&&e.removeClass(t,"menuShow"),t=n,e.addClass(t,"menuShow")),t}}(),M=e.debounce(function(){g.style.width=window.innerWidth+"px",g.style.height=window.innerHeight+"px"},250);return{init:h}}),define("app/app",["modules/utilities","modules/spacePlayer","modules/spacePigs","modules/spaceMenu"],function(e,t,n,i){function r(){window.addEventListener("resize",L),window.addEventListener("resize",k)}function o(){var e=window.innerWidth,t=window.innerHeight;b.detail.width=e,b.detail.height=t,t>e&&(h.dispatchEvent(b),E.detail.mode="portrait",h.dispatchEvent(E))}function a(e){switch(r(),m.addEventListener("click",c),e.detail.chapter){case 1:s();break;case 2:u();break;case 3:d();break;default:s()}o()}function s(){w.end.detail={chapter:1,winner:"",elapse:0,time:0};var e=t.init(h,g);n.init(h,[e],g),t.selectorInit(n.getPigs())}function u(){}function d(){}function c(e){e.stopPropagation(),w.end.detail.winner="abandon",h.dispatchEvent(w.end)}function l(e){window.removeEventListener("resize",L),window.removeEventListener("resize",k),m.removeEventListener("click",c)}function f(e,t){v.style.width=e+"px",v.style.height=t+"px"}function p(t){v=t.querySelector("#container"),h=t.querySelector("#space"),m=h.querySelector(" .quitButton"),h.addEventListener("gamestart",a,!1),h.addEventListener("gameend",l,!1),e.fullScreenChange(function(){e.orientation("landscape"),h.dispatchEvent(x)}),f(window.innerWidth,window.innerHeight),i.init(h,w)}var v=void 0,h=void 0,m=void 0,y=new CustomEvent("gamestart",{detail:{chapter:0}}),g=new CustomEvent("gameend",{detail:{chapter:0,winner:"",elapse:0,time:0}}),w={start:y,end:g},b=new CustomEvent("resizestart",{detail:{width:0,height:0}}),x=new CustomEvent("resizeend",{detail:{width:0,height:0}}),E=new CustomEvent("orientation",{detail:{mode:0}}),L=e.debounce(function(){b.detail.width=window.innerWidth,b.detail.height=window.innerHeight,h.dispatchEvent(b)},250,!0),k=e.debounce(function(){var e=window.innerWidth,t=window.innerHeight;x.detail.width=e,x.detail.height=t,f(e,t),t<e?(E.detail.mode="landscape",h.dispatchEvent(x),h.dispatchEvent(E)):(E.detail.mode="portrait",h.dispatchEvent(E))},250);return{init:p}});